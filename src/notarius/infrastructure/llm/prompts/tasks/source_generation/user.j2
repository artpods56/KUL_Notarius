<PROMPT_VERSION>0.0.1</PROMPT_VERSION>
<USER_REQUEST>
    <INSTRUCTION>
        Find the Latin source text on this schematism page that corresponds to the parsed Polish entries provided below.
        Extract values exactly as printed in Latin - do not translate or normalize.
    </INSTRUCTION>

    {% if previous_context %}
    <PREVIOUS_PAGE_CONTEXT>
        This page continues from a previous page. Use the following context:
        {% if previous_context.active_deanery %}
        <ACTIVE_DEANERY>{{ previous_context.active_deanery }}</ACTIVE_DEANERY>
        {% else %}
        <ACTIVE_DEANERY>null (no deanery was active at end of previous page)</ACTIVE_DEANERY>
        {% endif %}
        {% if previous_context.last_page_number %}
        <LAST_PAGE_NUMBER>{{ previous_context.last_page_number }}</LAST_PAGE_NUMBER>
        {% endif %}

        Use the inherited Latin deanery for entries appearing BEFORE any new deanery heading on this page.
    </PREVIOUS_PAGE_CONTEXT>
    {% else %}
    <PREVIOUS_PAGE_CONTEXT>
        This is the first page or no context is available. Set `deanery` to null for any entries
        appearing before a visible Latin deanery heading on this page.
    </PREVIOUS_PAGE_CONTEXT>
    {% endif %}

    {% if parsed_entries %}
    <PARSED_GROUND_TRUTH>
        These are the normalized Polish entries for this page. Find the corresponding Latin text on the image:
        ```json
{{ parsed_entries | tojson(indent=2) }}
        ```

        IMPORTANT:
        - Entries above may be in DIFFERENT ORDER than they appear on the page
        - Your output must follow PAGE VISUAL ORDER, not this order
        - Use these as guidance to LOCATE text, but extract LATIN values from the image
        - The Polish deanery names help identify which deanery, but output the LATIN form
    </PARSED_GROUND_TRUTH>
    {% endif %}

    {% if hints %}
    <MODEL_HINTS source="layoutlmv3">
        {{ hints }}
    </MODEL_HINTS>
    {% else %}
    <MODEL_HINTS>
        No model hints provided. Use your own analysis of the page scan.
    </MODEL_HINTS>
    {% endif %}

    {% if ocr_text %}
    <OCR_TEXT>
        {{ ocr_text }}
    </OCR_TEXT>
    {% endif %}

    <EXTRACTION_FOCUS>
        For each parsed entry, find on the page:
        - Latin parish name (often similar to Polish, may have Latin spelling)
        - Latin dedication (with abbreviations like S., SS., B.M.V.)
        - Latin building material (mur., lig., murata, lignea)
        - Latin deanery (Decanatus X) from heading or inherited context
    </EXTRACTION_FOCUS>

    <RESPONSE_FORMAT>
        Return only the JSON object as specified in OUTPUT_SCHEMA.
        All values must be LATIN as printed on the page.
        Entries must be in PAGE VISUAL ORDER (not parsed input order).
        No additional text or markdown.
    </RESPONSE_FORMAT>
</USER_REQUEST>
